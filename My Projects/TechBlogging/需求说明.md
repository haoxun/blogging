# 设计思路

TechBlogging 是一个利用 GitHub 架设个人技术博客的解决方案。

根据我的观察，目前有一些作者把自己的博文放在一个 repository 里，这样做的好处是：

* 简单直观地把博文集中到一个地方。
* 利用 GitHub 的渲染功能（比如自动渲染 Markdown 格式的博文）呈现博文。

于此同时，一些作者通过 GitHub Pages 服务架设自己的技术博客，常见的做法是通过 Jekyll 或者其他工具生成静态站点。与第一种方法相比，这种做法的好处是可以有更大的自由度，如绑定自定义的域名、灵活地控制博文的呈现方式等。

TechBologging 的解决方案是上述两种方案的混合版，其工作流如下：

1. 用户在某个 repository 中创建、修改、删除博文。
2. 用户调用 `tech-blogging` 命令行程序 commit changes，并 push 到 GitHub 。
3. `tech-blogging` 程序分析用户博文所在的 repository，以此生成站点，将生成的内容写入到另一个 repository（根据 GitHub Pages 的规则，个人技术站点的 repository 名称为 [username].github.io）。
4. 将生成的站点 push 到 GitHub。

# 需求说明

程序将对两个 repository 进行操作：

* 用户存放博文（或以 Markdown 格式书写）的 repository 。在下文中，此 repository 简称为 post-repo 。
* 存放生成站点的 repository 。在下文中，此 repository 简称为 site-repo 。

## 详细工作流程

以下是 tech-blogging 的程序工作流程：

1. 读取 user configuration ，如 post-repo 与 site-repo 的路径。
2. 对 post-repo 预处理，包括自动 commit & push 博文变更、分析 the latest commit 中的博文变更；读取 site-repo 的状态。
3. 根据用户选择的 mode 与 site-repo 的状态，为生成站点准备数据：
	1. 如果用户选择 global mode ，即忽略 post-repo 当前 commit 的变更与 site-repo 的状态，重新根据 post-repo 的内容生成站点，程序将为整个 post-repo 的博文做数据准备工作。
	2. 如果用户选择 incremental mode ，程序将根据当前 commit 的变更与 site-repo 的状态决定数据准备的逻辑：
		1. 如果 site-repo 的状态符合 post-repo 上一个 commit 的状态，程序仅会为站点生成步骤准备必要的数据，如仅处理新增的博文数据，而不会为整个 post-repo 的博文准备数据。
		2. 否则，采取 3.i 的数据准备策略。
4. 读取用户个性化的站点生成逻辑，并根据步骤 3 的数据生成站点。
5. 将生成的站点内容写入到 site-repo ， commit & push。

以下小节将详细介绍这 5 流程。

## 读取 user configuration

略。

## post-repo 预处理；读取 site-repo 状态

当用户在 post-repo 中调用 `tech-blogging` 时，post-repo 可能处于以下两种状态：

* post-repo is clean：
* post-repo is not clean。

为了更好的用户体验，如果程序检测到 post-repo is not clean 的情况，程序会将变更 commit & push。

对于 post-repo is clean 的情况，有两种可能：

* 用户更新了博文，并手动 commit & push 了变更.
* 用户更新了博文，并手动 commit 了变更，但没有 push .
* 用户没有更新博文。

由此，需要通过对比 site-repo 的状态来判断用户是否更新了博文，分为以下几种情况：

* 如果用户没有更新博文，程序退出；
* 如果用户更新了博文，没有 push ，程序会自动 push 。

所以，在此步骤完成后， post-repo 的状态应该是 clean 的。

除此之外，此步骤还需要收集以下信息：

* post-repo 的博文树。
* 博文变更，用三个列表描述，created\_posts （新增博文）、 deleted\_posts （被删除博文）、modified\_posts （内容有变更的博文）。
* 用于更新 site-repo 状态的信息。

## 为生成站点准备数据

comming soon.

## 生成站点

comming soon.

## 更新 site-repo

略。